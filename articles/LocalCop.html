<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LocalCop: Local likelihood inference for conditional copulas • LocalCop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="LocalCop: Local likelihood inference for conditional copulas">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LocalCop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/LocalCop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlysy/LocalCop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LocalCop: Local likelihood inference for conditional copulas</h1>
                        <h4 data-toc-skip class="author">Elif F. Acar, Martin Lysy</h4>
            
            <h4 data-toc-skip class="date">2024-03-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mlysy/LocalCop/blob/main/vignettes/LocalCop.Rmd" class="external-link"><code>vignettes/LocalCop.Rmd</code></a></small>
      <div class="hidden name"><code>LocalCop.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows how to use the <strong>LocalCop</strong> package to conduct local likelihood inference for the dependence parameters in conditional copula models, based on the works <span class="citation">Acar, Craiu, and Yao (<a href="#ref-ACY2011">2011</a>)</span>, <span class="citation">Acar, Craiu, and Yao (<a href="#ref-ACY2013">2013</a>)</span> and <span class="citation">Acar, Czado, and Lysy (<a href="#ref-ACL2019">2019</a>)</span>.</p>
<p><strong>LocalCop</strong> is primarily intended for users who want to apply conditional copula models to real-world data with an interest to infer covariate effects on the conditional dependence between two response variables. This is done semiparametrically using kernel smoothing within the likelihood framework as detailed below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlysy/LocalCop" class="external-link">LocalCop</a></span><span class="op">)</span>   <span class="co"># for conditional copula modeling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tnagler/VineCopula" class="external-link">VineCopula</a></span><span class="op">)</span> <span class="co"># for simulating copula data </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>      <span class="co"># for data manipulations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>      <span class="co"># and</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>    <span class="co"># plotting</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-generating-model">Data generating model<a class="anchor" aria-label="anchor" href="#data-generating-model"></a>
</h2>
<p>For any bivariate response vector <span class="math inline">\((Y_1, Y_2)\)</span>, the conditional joint distribution given a covariate <span class="math inline">\(X\)</span> is given by
<span class="math display" id="eq:fullmodel">\[\begin{equation}
F_X(y_1, y_2 \mid x) = C_X (F_{1\mid X} (y_1 \mid x),F_{2\mid X} (y_2 \mid x) \mid x ),
\tag{1}
\end{equation}\]</span>
where <span class="math inline">\(F_{1\mid X}(y_1 \mid x)\)</span> and <span class="math inline">\(F_{2\mid X}(y_2 \mid x)\)</span> are the conditional marginal distributions of <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_2\)</span> given <span class="math inline">\(X\)</span>, and <span class="math inline">\(C_X(u, v \mid x)\)</span> is a conditional copula function. That is, for given <span class="math inline">\(X = x\)</span>, the function <span class="math inline">\(C_X(u, v \mid x)\)</span> is a bivariate CDF with uniform margins.</p>
<p>If the true conditional marginal distrutions are known, we may compute the marginally uniform variables <span class="math inline">\(U = F_{1|X}(Y_1 \mid X)\)</span> and <span class="math inline">\(V = F_{2|X}(Y_2 \mid X)\)</span>. In practice these distributions are unknown, such that <span class="math inline">\(\hat U = \hat F_{1|X}(Y_1 \mid X)\)</span> and <span class="math inline">\(\hat V = \hat F_{1|X}(Y_2 \mid X)\)</span> are pseudo-uniform variables estimated using parametric or nonparametric techniques – see <span class="citation">Acar, Czado, and Lysy (<a href="#ref-ACL2019">2019</a>)</span> for an application using ARMA-GARCH models. Either way, the focus of <strong>LocalCop</strong> is on estimating the conditional copula function, which is given the semi-parametric model
<span class="math display" id="eq:copmod">\[\begin{equation}
C_X(u, v \mid x) = \mathcal{C}(u, v; \theta(x), \nu),
\tag{2}
\end{equation}\]</span>
where <span class="math inline">\(\mathcal{C}(u, v \; \theta, \nu)\)</span> is one of the parametric copula families listed in Table <a href="#tab:calib">1</a>, the copula dependence parameter <span class="math inline">\(\theta \in \Theta\)</span> is an arbitrary function of <span class="math inline">\(X\)</span>, and <span class="math inline">\(\nu \in \Upsilon\)</span> is an additional copula parameter present in some models. Since most parametric copula families have a restricted range <span class="math inline">\(\Theta \subsetneq \mathbb{R}\)</span>, we describe the data generating model (DGM) in terms of the calibration function <span class="math inline">\(\eta(x)\)</span>, such that
<span class="math display">\[\begin{equation}
\theta(x) = g^{-1}(\eta(x)),
\end{equation}\]</span>
where <span class="math inline">\(g^{-1}: \mathbb{R} \to \Theta\)</span> an inverse-link function which ensures that the copula parameter has the correct range. The choice of <span class="math inline">\(g^{-1}(\eta)\)</span> is not unique and depends on the copula family. Table <a href="#tab:calib">1</a> displays the copula function <span class="math inline">\(\mathcal{C}(u, v \mid \theta, \nu)\)</span> for each of the copula families provided by <strong>LocalCop</strong>, along with other relevant information including the canonical choice of the inverse link function <span class="math inline">\(g^{-1}(\eta)\)</span>. In Table <a href="#tab:calib">1</a>, <span class="math inline">\(\Phi^{-1}(p)\)</span> denotes the inverse CDF of the standard normal; <span class="math inline">\(t_{\nu}^{-1}(p)\)</span> denotes the inverse CDF of the Student-t with <span class="math inline">\(\nu\)</span> degrees of freedom; <span class="math inline">\(\Phi_{\theta}(z_1, z_2)\)</span> denotes the CDF of a bivariate normal with mean <span class="math inline">\((0, 0)\)</span> and variance <span class="math inline">\(\left[\begin{smallmatrix}1 &amp; \theta \\ \theta &amp; 1\end{smallmatrix}\right]\)</span>; and <span class="math inline">\(t_{\theta,\nu}(z_1, z_2)\)</span> denotes the CDF of a bivariate Student-t with location <span class="math inline">\((0, 0)\)</span>, scale <span class="math inline">\(\left[\begin{smallmatrix}1 &amp; \theta \\ \theta &amp; 1\end{smallmatrix}\right]\)</span>, and degrees of freedom <span class="math inline">\(\nu\)</span>.</p>
<!-- The canonical choices for the inverse link function for the copula families provided by **LocalCop** are given in Table \@ref(tab:calib), along with other relevant information about these families. -->
<!-- are defined in `BiCopEta2Par()` for various families (see `ConvertPar()` for details). The results are typically presented in the Kendall tau scale for interpretability across different copula families.  -->
<table class="table">
<caption>
<span id="tab:calib">Table 1: </span>Copula families implemented in <strong>LocalCop</strong>.
</caption>
<thead><tr>
<th style="text-align:left;">
Family
</th>
<th style="text-align:left;">
<span class="math inline">\(\mathcal{C}(u, v \mid \theta,\nu)\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\theta \in \Theta\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\nu \in \Upsilon\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(g^{-1}(\eta)\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\tau(\theta)\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Gaussian
</td>
<td style="text-align:left;">
<span class="math inline">\(\Phi_\theta ( \Phi^{-1}(u), \Phi^{-1}(v))\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\((-1,1)\)</span>
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
<span class="math inline">\(\dfrac{e^{\eta} - e^{-\eta}}{e^{\eta} + e^{-\eta}}\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{2}{\pi}\arcsin(\theta)\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Student-t
</td>
<td style="text-align:left;">
<span class="math inline">\(t_{\theta,\nu} ( t_\nu^{-1}(u), t_\nu^{-1}(v))\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\((-1,1)\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\((0, \infty)\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\(\dfrac{e^{\eta} - e^{-\eta}}{e^{\eta} + e^{-\eta}}\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{2}{\pi}\arcsin(\theta)\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Clayton
</td>
<td style="text-align:left;">
<span class="math inline">\(\displaystyle (u^{-\theta} + v^{-\theta} -1)^{-\frac{1}{\theta}}\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\((0, \infty)\)</span>
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
<span class="math inline">\(e^\eta\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\(\frac{\theta}{\theta + 2}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Gumbel
</td>
<td style="text-align:left;">
<span class="math inline">\(\displaystyle  \exp\left[ - \{  (-\log u)^\theta + (-\log v)^\theta\}^{\frac{1}{\theta}} \right]\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\([1, \infty)\)</span>
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
<span class="math inline">\(e^\eta + 1\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\(1 - \frac{1}{\theta}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Frank
</td>
<td style="text-align:left;">
<span class="math inline">\(-\frac{1}{\theta}\log \left\{ 1 + \frac{(e^{-\theta u} - 1)(e^{-\theta v} - 1)}{e^{-\theta} - 1}\right\}\)</span>
</td>
<td style="text-align:left;">
<span class="math inline">\((-\infty, \infty)\setminus\{0\}\)</span>
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
<span class="math inline">\(\eta\)</span>
</td>
<td style="text-align:left;">
no closed form
</td>
</tr>
</tbody>
</table>
<p>The code below shows how to simulate data from model <a href="#eq:copmod">(2)</a> using the Gumbel family, where the change in Kendall <span class="math inline">\(\tau\)</span> as a function of the covariate in displayed in Figure <a href="#fig:dgm">1</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate copula data given a covariate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span> </span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fl">4</span>  <span class="co"># Gumbel Copula </span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>    <span class="co"># number of observations</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>  <span class="co"># covariate values</span></span>
<span><span class="va">eta_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="co"># calibration function</span></span>
<span></span>
<span><span class="co"># simulate data</span></span>
<span><span class="va">eta_true</span> <span class="op">&lt;-</span> <span class="fu">eta_fun</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">par_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Par</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">family</span>, eta <span class="op">=</span> <span class="va">eta_true</span><span class="op">)</span> <span class="co"># copula parameter</span></span>
<span><span class="va">udata</span> <span class="op">&lt;-</span> <span class="fu">VineCopula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/VineCopula/man/BiCopSim.html" class="external-link">BiCopSim</a></span><span class="op">(</span><span class="va">n</span>, family <span class="op">=</span> <span class="va">family</span>, par <span class="op">=</span> <span class="va">par_true</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot tau(x)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, len <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    tau <span class="op">=</span> <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Tau</a></span><span class="op">(</span><span class="va">family</span>, eta <span class="op">=</span> <span class="fu">eta_fun</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">tau</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">tau</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dgm"></span>
<img src="LocalCop_files/figure-html/dgm-1.png" alt="Conditional Kendall $\tau$ for Gumbel copula under DGM."><p class="caption">
Figure 1: Conditional Kendall <span class="math inline">\(\tau\)</span> for Gumbel copula under DGM.
</p>
</div>
<!-- To generate $(Y_1, Y_2)$ in \@ref(eq:fullmodel), one must specify the conditional marginal models $F_{1|X}(y_1 \mid x)$ and $F_{2|X}(y_2 \mid x)$ -- see @ACL2019 for an application with ARMA-GARCH type marginal modeling.   -->
<!-- This would allow investigating the impact of estimating or misspecifying the conditional marginal models in practical applications.  -->
<!-- For simplicity, we will proceed by assuming that the true conditional marginal models are known, using the marginally uniforma variables $U = F_{1|X}(Y_1 \mid X)$ and $V = F_{2|X}(Y_2 \mid X)$.   -->
<!-- brevity, we will proceed with the uniform data assuming that the true marginal models are used.  -->
</div>
<div class="section level2">
<h2 id="local-likelihood-estimation-of-the-dependence-parameter">Local likelihood estimation of the dependence parameter<a class="anchor" aria-label="anchor" href="#local-likelihood-estimation-of-the-dependence-parameter"></a>
</h2>
<p>Local likelihood estimation uses Taylor expansions to approximate the dependence parameter function at an observed covariate value <span class="math inline">\(X = x\)</span> near a fixed point <span class="math inline">\(X = x_0\)</span>, i.e.,
<span class="math display">\[
\eta(x)\approx \eta(x_0) + \eta^{(1)}(x_0) (x - x_0) + \ldots + \dfrac{\eta^{(p)}(x_0)}{p!} (x - x_0)^{p}.
\]</span>
One then estimates <span class="math inline">\(\beta_k = \eta^{(k)}(x_0)/k!\)</span> for <span class="math inline">\(k = 0,\ldots,p\)</span> using a kernel-weighted local likelihood function
<span class="math display" id="eq:locallik">\[\begin{equation}
\ell(\boldsymbol{\beta}) = \sum_{i=1}^n \log\left\{ c\left(u_i, v_i ; g^{-1}( \boldsymbol{x}_{i}^T \boldsymbol{\beta}), \nu \right)\right\} K_h\left(\dfrac{x_i-x_0}{h}\right),
\tag{3}
\end{equation}\]</span>
where <span class="math inline">\((u_i, v_i, x_i)\)</span> is the data for observation <span class="math inline">\(i\)</span>, <span class="math inline">\(\boldsymbol{x}_i = (1, x_i - x_0, (x_i - x_0)^2, \ldots, (x_i - x_0)^p)\)</span>, <span class="math inline">\(\boldsymbol{\beta}= (\beta_0, \beta_1, \ldots, \beta_p)\)</span>, and <span class="math inline">\(K_h(z)\)</span> is a kernel function with bandwidth parameter <span class="math inline">\(h &gt; 0\)</span>. Having maximized <span class="math inline">\(\ell(\boldsymbol{\beta})\)</span> in <a href="#eq:locallik">(3)</a>, one estimates <span class="math inline">\(\eta(x_0)\)</span> by <span class="math inline">\(\hat \eta(x_0) = \hat \beta_0\)</span>. Usually, a linear fit with <span class="math inline">\(p=1\)</span> suffices to obtain a good estimate in practice. The estimation procedure for a single value of <span class="math inline">\(X = x_0\)</span> for given copula family and bandwidth parameter is carried out by <code><a href="../reference/CondiCopLocFit.html">CondiCopLocFit()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">band</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">degree</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">kernel</span> <span class="op">&lt;-</span> <span class="va">KernEpa</span> <span class="co"># Epanichov kernel (default value)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CondiCopLocFit.html">CondiCopLocFit</a></span><span class="op">(</span></span>
<span>  u1 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, u2 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  x0 <span class="op">=</span> <span class="va">x0</span>,</span>
<span>  family <span class="op">=</span> <span class="va">family</span>, </span>
<span>  degree <span class="op">=</span> <span class="va">degree</span>,</span>
<span>  kernel <span class="op">=</span> <span class="va">kernel</span>,</span>
<span>  band <span class="op">=</span> <span class="va">band</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit1</span></span>
<span><span class="co">#&gt; $x</span></span>
<span><span class="co">#&gt; [1] 0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $eta</span></span>
<span><span class="co">#&gt; [1] 0.839931</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nu</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Repeating this procedure over a grid of covariate values produces an estimate <span class="math inline">\(\hat \eta(x)\)</span> of the underlying dependence function. This can also be accomplished with <code><a href="../reference/CondiCopLocFit.html">CondiCopLocFit()</a></code> as shown below.</p>
<!-- allows to capture the underlying dependence parameter function. The function `CondiCopLocFit()` allows inputting a vector of fixed points for a given family and bandwidth.  -->
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="va">fitseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CondiCopLocFit.html">CondiCopLocFit</a></span><span class="op">(</span></span>
<span>  u1 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, u2 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">x</span>, </span>
<span>  x0 <span class="op">=</span> <span class="va">x0</span>,</span>
<span>  family <span class="op">=</span> <span class="va">family</span>, </span>
<span>  degree <span class="op">=</span> <span class="va">degree</span>,</span>
<span>  kernel <span class="op">=</span> <span class="va">kernel</span>,</span>
<span>  band <span class="op">=</span> <span class="va">band</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot true vs fitted tau</span></span>
<span><span class="va">legend_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">tau</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x0</span>,</span>
<span>  True <span class="op">=</span> <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Tau</a></span><span class="op">(</span><span class="va">family</span>, eta <span class="op">=</span> <span class="fu">eta_fun</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Fitted <span class="op">=</span> <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Tau</a></span><span class="op">(</span><span class="va">fitseq</span><span class="op">$</span><span class="va">eta</span>, family<span class="op">=</span> <span class="va">family</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">True</span><span class="op">:</span><span class="va">Fitted</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Type"</span>, values_to <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="st">"Fitted"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, group <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Type</span>, linetype <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Type</span>, color <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">legend_names</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">16</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">legend_names</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>, <span class="cn">NA</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">legend_names</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Kendall "</span><span class="op">*</span><span class="va">tau</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:localseq"></span>
<img src="LocalCop_files/figure-html/localseq-1.png" alt="Conditional Kendall $\tau$ estimates under the Gumbel copula using bandwidth $h=0.1$."><p class="caption">
Figure 2: Conditional Kendall <span class="math inline">\(\tau\)</span> estimates under the Gumbel copula using bandwidth <span class="math inline">\(h=0.1\)</span>.
</p>
</div>
</div>
<div class="section level2">
<h2 id="copula-selection-and-model-tuning">Copula Selection and Model Tuning<a class="anchor" aria-label="anchor" href="#copula-selection-and-model-tuning"></a>
</h2>
<p>Selection of the copula family and bandwidth parameter is done via leave-one-out cross-validation (LOO-CV) as described in <span class="citation">Acar, Czado, and Lysy (<a href="#ref-ACL2019">2019</a>)</span>. To reduce the computation time in model selection, we may calculate the LOO-CV for just a subset of the sample.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bandset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># bandwidth set</span></span>
<span><span class="va">famset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span> <span class="co"># family set</span></span>
<span><span class="va">n_loo</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># number of leave-one-out observations in CV likelihood calculation</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">cvselect1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CondiCopSelect.html">CondiCopSelect</a></span><span class="op">(</span></span>
<span>    u1 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, u2 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">x</span>,</span>
<span>    family <span class="op">=</span> <span class="va">famset</span>, </span>
<span>    degree <span class="op">=</span> <span class="va">degree</span>,</span>
<span>    kernel <span class="op">=</span> <span class="va">kernel</span>,</span>
<span>    band <span class="op">=</span> <span class="va">bandset</span>,</span>
<span>    xind <span class="op">=</span> <span class="va">n_loo</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_res1</span> <span class="op">&lt;-</span> <span class="va">cvselect1</span><span class="op">$</span><span class="va">cv</span></span>
<span><span class="va">cv_res1</span></span>
<span><span class="co">#&gt;    band family       cv</span></span>
<span><span class="co">#&gt; 1   0.1      1 33.72408</span></span>
<span><span class="co">#&gt; 2   0.2      1 30.22907</span></span>
<span><span class="co">#&gt; 3   0.4      1 26.91116</span></span>
<span><span class="co">#&gt; 4   0.8      1 27.22770</span></span>
<span><span class="co">#&gt; 5   1.0      1 27.54328</span></span>
<span><span class="co">#&gt; 6   0.1      2 34.95500</span></span>
<span><span class="co">#&gt; 7   0.2      2 31.06883</span></span>
<span><span class="co">#&gt; 8   0.4      2 28.20758</span></span>
<span><span class="co">#&gt; 9   0.8      2 28.92498</span></span>
<span><span class="co">#&gt; 10  1.0      2 29.21409</span></span>
<span><span class="co">#&gt; 11  0.1      3 23.26226</span></span>
<span><span class="co">#&gt; 12  0.2      3 20.51586</span></span>
<span><span class="co">#&gt; 13  0.4      3 17.96064</span></span>
<span><span class="co">#&gt; 14  0.8      3 18.34648</span></span>
<span><span class="co">#&gt; 15  1.0      3 18.45101</span></span>
<span><span class="co">#&gt; 16  0.1      4 38.68924</span></span>
<span><span class="co">#&gt; 17  0.2      4 34.64196</span></span>
<span><span class="co">#&gt; 18  0.4      4 30.75936</span></span>
<span><span class="co">#&gt; 19  0.8      4 31.43345</span></span>
<span><span class="co">#&gt; 20  1.0      4 31.77389</span></span>
<span><span class="co">#&gt; 21  0.1      5 29.72769</span></span>
<span><span class="co">#&gt; 22  0.2      5 25.59749</span></span>
<span><span class="co">#&gt; 23  0.4      5 23.23388</span></span>
<span><span class="co">#&gt; 24  0.8      5 24.02684</span></span>
<span><span class="co">#&gt; 25  1.0      5 24.43723</span></span></code></pre></div>
<p>The leave-one-out cross-validation for the full sample is provided below for comparisons.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">cvselect2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CondiCopSelect.html">CondiCopSelect</a></span><span class="op">(</span></span>
<span>    u1 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, u2 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">x</span>,</span>
<span>    family <span class="op">=</span> <span class="va">famset</span>, </span>
<span>    degree <span class="op">=</span> <span class="va">degree</span>,</span>
<span>    kernel <span class="op">=</span> <span class="va">kernel</span>,</span>
<span>    band <span class="op">=</span> <span class="va">bandset</span>,</span>
<span>    xind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">udata</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_res2</span> <span class="op">&lt;-</span> <span class="va">cvselect2</span><span class="op">$</span><span class="va">cv</span></span>
<span><span class="va">cv_res2</span></span>
<span><span class="co">#&gt;    band family       cv</span></span>
<span><span class="co">#&gt; 1   0.1      1 422.2925</span></span>
<span><span class="co">#&gt; 2   0.2      1 380.4366</span></span>
<span><span class="co">#&gt; 3   0.4      1 353.6886</span></span>
<span><span class="co">#&gt; 4   0.8      1 350.2815</span></span>
<span><span class="co">#&gt; 5   1.0      1 348.7304</span></span>
<span><span class="co">#&gt; 6   0.1      2 428.2676</span></span>
<span><span class="co">#&gt; 7   0.2      2 395.4231</span></span>
<span><span class="co">#&gt; 8   0.4      2 374.7095</span></span>
<span><span class="co">#&gt; 9   0.8      2 373.3327</span></span>
<span><span class="co">#&gt; 10  1.0      2 372.6614</span></span>
<span><span class="co">#&gt; 11  0.1      3 252.9172</span></span>
<span><span class="co">#&gt; 12  0.2      3 234.8385</span></span>
<span><span class="co">#&gt; 13  0.4      3 221.4233</span></span>
<span><span class="co">#&gt; 14  0.8      3 220.4843</span></span>
<span><span class="co">#&gt; 15  1.0      3 219.8683</span></span>
<span><span class="co">#&gt; 16  0.1      4 461.6522</span></span>
<span><span class="co">#&gt; 17  0.2      4 421.7474</span></span>
<span><span class="co">#&gt; 18  0.4      4 394.1287</span></span>
<span><span class="co">#&gt; 19  0.8      4 391.4590</span></span>
<span><span class="co">#&gt; 20  1.0      4 390.0860</span></span>
<span><span class="co">#&gt; 21  0.1      5 384.3447</span></span>
<span><span class="co">#&gt; 22  0.2      5 347.7702</span></span>
<span><span class="co">#&gt; 23  0.4      5 325.6584</span></span>
<span><span class="co">#&gt; 24  0.8      5 325.0720</span></span>
<span><span class="co">#&gt; 25  1.0      5 324.6259</span></span></code></pre></div>
<p>Figure <a href="#fig:cvplot">3</a> displays the LOO-CV metric (larger is better) for both the full sample (<span class="math inline">\(n = 1000\)</span>) and a subset of the sample (<span class="math inline">\(n = 100\)</span>). The rank of each combination of family and bandwidth is very similar in both settings. In particular, i both cases we select the Gumbel copula with bandwidth parameter <span class="math inline">\(h = 0.1\)</span>. This suggests that subset-based model selection can be used to reduce the computation time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fam_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gaussian"</span>, <span class="st">"Student"</span>, <span class="st">"Clayton"</span>, <span class="st">"Gumbel"</span>, <span class="st">"Frank"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">cvselect1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_loo</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">cvselect2</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">udata</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">family</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="va">fam_names</span><span class="op">)</span>,</span>
<span>    Bandwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">band</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"n = "</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">family</span>, y  <span class="op">=</span> <span class="va">cv</span>, fill <span class="op">=</span> <span class="va">Bandwidth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Blues"</span>, direction<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"CV Likelihood"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cvplot"></span>
<img src="LocalCop_files/figure-html/cvplot-1.png" alt="Cross-validated likelihood for copula and bandwidth selection based on a subset and the full sample."><p class="caption">
Figure 3: Cross-validated likelihood for copula and bandwidth selection based on a subset and the full sample.
</p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-to-the-choice-of-copula-family">Sensitivity to the choice of copula family<a class="anchor" aria-label="anchor" href="#sensitivity-to-the-choice-of-copula-family"></a>
</h2>
<p>Figure <a href="#fig:localseq2">4</a> displays the true and estimated conditional Kendall <span class="math inline">\(\tau\)</span> for each of the copula families using the selected bandwidth parameter <span class="math inline">\(h = 0.1\)</span>. The results suggest that misspecification of the copula family does not drastically affect the local likelihood estimates of <span class="math inline">\(\tau(x)\)</span>, except for the Clayton copula which shows the most departure from the Gumbel copula used in the DGM.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">tau_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fam_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CondiCopLocFit.html">CondiCopLocFit</a></span><span class="op">(</span></span>
<span>    u1 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, u2 <span class="op">=</span> <span class="va">udata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, x <span class="op">=</span> <span class="va">x</span>,</span>
<span>    x0 <span class="op">=</span> <span class="va">x0</span>,</span>
<span>    family <span class="op">=</span> <span class="va">fam_id</span>, </span>
<span>    degree <span class="op">=</span> <span class="va">degree</span>,</span>
<span>    kernel <span class="op">=</span> <span class="va">kernel</span>,</span>
<span>    band <span class="op">=</span> <span class="va">band</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Tau</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">eta</span>, family<span class="op">=</span><span class="va">fam_id</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tau_est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fam_names</span></span>
<span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">tau_est</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">x0</span>,</span>
<span>    True <span class="op">=</span> <span class="fu"><a href="../reference/ConvertPar.html">BiCopEta2Tau</a></span><span class="op">(</span><span class="va">family</span>, eta <span class="op">=</span> <span class="fu">eta_fun</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">x</span>, names_to <span class="op">=</span> <span class="st">"Type"</span>, values_to <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="va">fam_names</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">tau</span>, group <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Type</span>, linewidth <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span>, <span class="st">"orange"</span>, <span class="st">"green4"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">tau</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:localseq2"></span>
<img src="LocalCop_files/figure-html/localseq2-1.png" alt="Conditional Kendall $\tau$ estimates under different copula families."><p class="caption">
Figure 4: Conditional Kendall <span class="math inline">\(\tau\)</span> estimates under different copula families.
</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ACY2011" class="csl-entry">
Acar, Elif F., Radu V. Craiu, and Fang Yao. 2011. <span>“Dependence Calibration in Conditional Copulas: A Nonparametric Approach.”</span> <em>Biometrics</em> 67 (2): 445–53.
</div>
<div id="ref-ACY2013" class="csl-entry">
———. 2013. <span>“Statistical Testing of Covariate Effects in Conditional Copula Models.”</span> <em>Electronic Journal of Statistics</em> 7: 2822–50.
</div>
<div id="ref-ACL2019" class="csl-entry">
Acar, Elif F., Claudia Czado, and Martin Lysy. 2019. <span>“Dynamic Vine Copula Models for Multivariate Time Series Data.”</span> <em>Econometrics and Statistics</em> 12: 181–97.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <!-- <p>Copyright 2017-2019 Martin Lysy</p> -->
  <script>
    function get_date() {
	// return "aaaa";
	var x = new Date(Date.parse(document.lastModified));
	var d = x.getDate();
	var m = x.getMonth() + 1;
	var y = x.getYear();
	// different on IE and NS
	if(y >= 2000)
	{
	    y -= 2000;
	}
	if(y >= 100)
	{
	    y -= 100;
	}
	y = y + 2000;
	// x = new Date(x);
	// return x.getMonth();
	return "" + m + "/" + d + "/" + y;
    }
  </script><p>Last updated: <script> document.write(get_date()) </script></p>


<!-- <div class="copyright"> -->
<!--   <p>Developed by . </p> -->
<!-- </div> -->

<!-- <div class="author"> -->
<!--   <p> -->
<!--     Developed by . -->
<!--     Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a> & <a href="https://ropensci.github.io/rotemplate/">rotemplate</a>. -->
<!--   </p> -->
<!-- </div> -->


      
   </div>






  </footer>
</div>
</body>
</html>
